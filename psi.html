<!DOCTYPE html>
<html>

<head>
  <meta charset='utf-8' />
  <title>Public Space Invitational Installation Sites</title>
  <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
  <script src="https://d3js.org/d3.v7.min.js"></script>    
  <link href="https://api.mapbox.com/mapbox-gl-js/v3.17.0/mapbox-gl.css" rel="stylesheet" />
  <script src="https://api.mapbox.com/mapbox-gl-js/v3.17.0/mapbox-gl.js"></script>
  <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.4.2/mapbox-gl-geocoder.css" type="text/css">
  <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.4.2/mapbox-gl-geocoder.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">
<style>
    body {
      margin: 0;
      padding: 0;
      font-family:"Inter","Helvetica Neue", Helvetica, Arial, sans-serif;
      color: #333;
    }

    #map {
      position: absolute;
      top: 0;
      bottom: 0;
      width: 100%;
    }

    .mapboxgl-marker {
        cursor: pointer;
    }

    .mapboxgl-popup {
      padding-bottom: 5px;
      z-index: 999;
    }

    .mapboxgl-popup-close-button {
      display: none;
    }

    .mapboxgl-popup-content {
      font: 400 15px/22px 'Source Sans Pro', 'Helvetica Neue', Sans-serif;
      padding: 0;
      width: 300px;
      max-width: 90vw;
    }

    .mapboxgl-popup-content-wrapper {
      padding: 1%;
    }

    .mapboxgl-popup-content h3 {
      color: #fff;
      margin: 0;
      display: block;
      padding: 15px;
      font-weight: 700;
      margin-top: -5px;
      font-size: 18px;
    }

    .mapboxgl-popup-content h4 {
      margin: 0;
      padding: 10px;
      font-weight: 600;
      font-size: 16px;
      color: #333;
    }

    .mapboxgl-popup-content .authors {
      background-color: #f7f7f7;
      padding: 8px 10px;
      font-style: italic;
      color: #555;
      font-size: 13px;
      border-bottom: 1px solid #eee;
    }

    .mapboxgl-popup-content .description {
      padding: 10px;
      line-height: 1.5;
      color: #444;
    }

    .mapboxgl-container {
      cursor: pointer;
    }
    
    .mapboxgl-ctrl-geocoder {
      width: 315px!important;
    }

    .mapboxgl-ctrl-logo {
      display: none !important;
    }
  
    .legend {
      position: absolute;
      bottom: 25px;
      left: 10px;
      background: white;
      padding: 15px;
      border-radius: 5px;
      box-shadow: 0 1px 2px rgba(0,0,0,0.1);
      font-size: 13px;
      z-index: 1;
    }

    .legend h4 {
      margin: 0 0 10px 0;
      font-size: 14px;
      font-weight: 700;
    }

    .legend-item {
      margin: 5px 0;
      display: flex;
      align-items: center;
    }

    .legend-color {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      margin-right: 8px;
      display: inline-block;
    }

    .mapboxgl-popup-anchor-top>.mapboxgl-popup-content {
      margin-top: 5px;
    }

    .mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip {
        border-top-color: #fff !important;
    }

    .mapboxgl-popup {
        -webkit-filter: drop-shadow(0 0px 1px rgba(0,0,0,0.9));
        filter: drop-shadow(0 0px 1px rgba(0,0,0,0.9));
    }
  </style>
</head>
<body>
<div id="map"></div>
<div class="legend">
  <h4>Categories</h4>
  <div class="legend-item">
    <span class="legend-color" style="background-color: #284384;"></span>
    <span>Pop-up Infrastructure</span>
  </div>
  <div class="legend-item">
    <span class="legend-color" style="background-color: #4e9bb8;"></span>
    <span>Technology + Participation</span>
  </div>
  <div class="legend-item">
    <span class="legend-color" style="background-color: #2A644D;"></span>
    <span>Simple Tools, Simple Materials</span>
  </div>
  <div class="legend-item">
    <span class="legend-color" style="background-color: #3c8c99;"></span>
    <span>Storytelling + History</span>
  </div>
  <div class="legend-item">
    <span class="legend-color" style="background-color: #452d88;"></span>
    <span>Reinventing Infrastructure</span>
  </div>
  <div class="legend-item">
    <span class="legend-color" style="background-color: #3D9970;"></span>
    <span>Green Infrastructure</span>
  </div>
</div>
<script>
    
    var locationData;
    
    var transformRequest = (url, resourceType) => {
      var isMapboxRequest =
        url.slice(8, 22) === "api.mapbox.com" ||
        url.slice(10, 26) === "tiles.mapbox.com";
      return {
        url: isMapboxRequest
          ? url.replace("?", "?pluginName=sheetMapper&")
          : url
      };
    };

    // Category color mapping
    function getCategoryColor(category) {
      const colors = {
        'Pop-up Infrastructure': '#284384',
        'Technology + Participation': '#4e9bb8',
        'Simple Tools, Simple Materials': '#2A644D',
        'Storytelling + History': '#3c8c99',
        'Reinventing Infrastructure': '#452d88',
        'Green Infrastructure': '#3D9970'
      };
      return colors[category] || '#666666';
    }

    mapboxgl.accessToken = 'pk.eyJ1Ijoib2V0Ym9zdG9uIiwiYSI6ImNtNzJ1aTMwOTAyNHEya29vOGN6cTV2M2kifQ.rEQ5ubToGj8SRNhMyytcmw';
    
    var map = new mapboxgl.Map({
      container: 'map',
      style: 'mapbox://styles/oetboston/cmjtixsjc007c01qs5vqd69y7',
      //style: 'mapbox://styles/mapbox/light-v10',
      center: [-71.0616, 42.3365],
      zoom: 11,
      hash: true,
      attributionControl: false,
      transformRequest: transformRequest
    });

    map.addControl(new mapboxgl.AttributionControl({
      compact: false,
      customAttribution: 'OETBoston'
    }), 'bottom-right');
    
    map.scrollZoom.disable();
    
    map.addControl(new mapboxgl.NavigationControl(), 'bottom-right');

    d3.json("sites.geojson").then(function(data){ 
        for (var i=0; i < data.features.length; i++) {
            if (data.features[i].geometry.type == "Point" && 
                data.features[i].geometry.coordinates.length === 2){
                
                var props = data.features[i].properties;
                
                // Get color based on category
                var col = getCategoryColor(props.category);

                // Build popup content with category-colored header and tip styling (only for bottom/up position)
                var popupHTML = '<style>' +
                    // Only handle the dynamic color for the Upward pointing tip here
                    '.mapboxgl-popup-anchor-top > .mapboxgl-popup-tip { border-bottom-color: ' + col + '; }' +
                    '</style>' +
                    '<h3 style="background-color: ' + col + ';">' + props.name + '</h3>';
                
                if (props.authors) {
                    popupHTML += '<div class="authors">By: ' + props.authors + '</div>';
                }
                
                popupHTML += '<div class="description">' + props.about + '</div>';

                //popupHTML += '<div class="description"><strong>' + props.competitiontitle + '</strong></div>';

                const popup = new mapboxgl.Popup({ offset: 25 }).setHTML(popupHTML);
                 
                new mapboxgl.Marker({ color: col, scale: .8, rotation: 0 })
                .setPopup(popup)
                .setLngLat(data.features[i].geometry.coordinates)
                .addTo(map);
            }
        }
    });
</script>
 
</body>
</html>
